{% extends "store/base.html" %}
{% load static %}
{% block title %}{{ product.name }} | Swag{% endblock %}
{% block content %}
{% csrf_token %}
<div class="product-detail-container">
    <!-- Enhanced breadcrumb navigation -->
    <nav class="product-navigation" aria-label="Product Navigation">
        <a href="/" class="nav-link">Home</a>
        <span class="nav-separator">/</span>
        <a href="#" onclick="history.back(); return false;" class="nav-link">Shop</a>
        <span class="nav-separator">/</span>
        <span class="current-page">{{ product.name }}</span>
    </nav>

    <div class="product-grid">
        <!-- Left Column - Images Gallery -->
        <div class="product-images">
            <!-- Main large image -->
            <div class="main-image-container">
                {% if product.images.all %}
                    <div class="main-image" id="main-product-image">
                        {% if product.images.all.0.image %}
                            <img src="{{ product.images.all.0.image.url }}" alt="{{ product.images.all.0.alt_text|default:product.name }}" loading="lazy">
                        {% else %}
                            <img src="{{ product.images.all.0.image_url }}" alt="{{ product.images.all.0.alt_text|default:product.name }}" loading="lazy">
                        {% endif %}
                        
                        {% if product.quantity == 0 %}
                        <div class="sold-out-badge">
                            <span>Sold out</span>
                        </div>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="no-image-placeholder">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                        <p>No images available</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- Thumbnails gallery slider -->
            {% if product.images.all %}
                <div class="thumbnail-gallery">
                    {% for image in product.images.all %}
                        <div class="thumbnail" onclick="changeMainImage(this, {{ forloop.counter0 }})">
                            {% if image.image %}
                                <img src="{{ image.image.url }}" alt="{{ image.alt_text|default:'Product view' }}" loading="lazy">
                            {% else %}
                                <img src="{{ image.image_url }}" alt="{{ image.alt_text|default:'Product view' }}" loading="lazy">
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        
        <!-- Right Column - Product Information -->
        <div class="product-info">
            <div class="product-header">
                <h1 class="product-title">{{ product.name }}</h1>
                <div class="product-price-tag">
                    <span class="currency">LE</span>
                    <span class="amount">{{ product.price }}</span>
                </div>
            </div>
            
            <!-- Product rating (placeholder) -->
            <div class="product-rating">
                <div class="stars">
                    {% with ''|center:product.average_rating as range %}
                    {% for _ in range %}
                        <span class="star filled">★</span>
                    {% endfor %}
                    {% endwith %}
                    {% if product.average_rating < 5 %}
                        {% with ''|center:5|slice:product.average_rating as empty_range %}
                        {% for _ in empty_range %}
                            <span class="star">★</span>
                        {% endfor %}
                        {% endwith %}
                    {% endif %}
                </div>
                <span class="review-count">({{ product.total_reviews }} reviews)</span>
            </div>
            
            <div class="product-description">
                <h2 class="section-title">Product Description</h2>
                <p>{{ product.description }}</p>
            </div>
            
            <div class="product-attributes">
                <div class="attribute">
                    <span class="attribute-label">Gender:</span>
                    <span class="attribute-value">{% if product.gender == 'M' %}Male{% else %}Female{% endif %}</span>
                </div>
                <div class="attribute">
                    <span class="attribute-label">Availability:</span>
                    <span class="attribute-value">{% if product.quantity > 0 %}{{ product.quantity }} in stock{% else %}Out of stock{% endif %}</span>
                </div>

                <div class="attribute">
                    <span class="attribute-label">Material:</span>
                    <span class="attribute-value">{{ product.material|default:"Cotton" }}</span>
                </div>
            </div>
            
            <!-- Size selector -->
            <div class="product-size-selector">
                <label for="size" class="selector-label">Size:</label>
                <div class="size-options">
                    {% for size in product.sizes.all %}
                         <input type="radio" name="size" id="size-{{ size.name }}" value="{{ size.id }}" {% if forloop.first %}checked{% endif %}>
                         <label for="size-{{ size.name }}" class="size-option">{{ size.name }}</label>
                     {% endfor %}
                </div>
            </div>

            <!-- Color selector -->
            <div class="product-color-selector">
                <label for="color" class="selector-label">Color:</label>
                <div class="color-options">
                    {% for color in product.colors.all %}
                        <input type="radio" name="color" id="color-{{ color.id }}" value="{{ color.id }}" data-color-name="{{ color.name }}" {% if forloop.first %}checked{% endif %}>
                        <label for="color-{{ color.id }}" class="color-option" style="background-color: {{ color.hex_code }}; {% if color.hex_code == '#FFFFFF' %}border: 1px solid #ddd{% endif %}"></label>
                    {% endfor %}
                </div>
            </div>

            {% if product.quantity > 0 %}
                <div class="quantity-selector">
                    <span class="quantity-label">Quantity:</span>
                    <div class="quantity-controls">
                        <button type="button" class="quantity-btn minus" onclick="decrementQuantity()" aria-label="Decrease quantity">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                        <input type="number" id="product-quantity" value="1" min="1" max="{{ product.quantity }}" aria-label="Product quantity">
                        <button type="button" class="quantity-btn plus" onclick="incrementQuantity()" aria-label="Increase quantity">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                    </div>
                </div>
            {% endif %}

            <div class="action-buttons">
                {% if product.quantity > 0 %}
                    <button class="add-to-cart-btn" id="add-to-cart-button">
                        <span class="btn-text">Add to Cart</span>
                        <span class="btn-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="9" cy="21" r="1"></circle>
                                <circle cx="20" cy="21" r="1"></circle>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                            </svg>
                        </span>
                    </button>

                {% else %}
                    <button class="add-to-cart-btn disabled" disabled>
                        <span class="btn-text">Out of Stock</span>
                    </button>
                    <button class="notify-me-btn">Notify Me</button>
                {% endif %}
            </div>
            
            <!-- Product sharing -->
            <div class="social-share">
                <h2 class="section-title">Share this product</h2>
                <div class="social-buttons">
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" 
                       class="social-button facebook" 
                       title="Share on Facebook" 
                       target="_blank" rel="noopener noreferrer">
                        <svg class="social-icon" viewBox="0 0 24 24" width="20" height="20">
                            <path d="M20 12.05C19.9813 10.5255 19.5273 9.03809 18.6915 7.76295C17.8557 6.48781 16.673 5.47804 15.2826 4.85257C13.8921 4.2271 12.3519 4.01198 10.8433 4.23253C9.33473 4.45309 7.92057 5.10013 6.7674 6.09748C5.61422 7.09482 4.77005 8.40092 4.3343 9.86195C3.89856 11.323 3.88938 12.8781 4.30786 14.3442C4.72634 15.8103 5.55504 17.1262 6.69637 18.1371C7.83769 19.148 9.24412 19.8117 10.75 20.05V14.38H8.75001V12.05H10.75V10.28C10.7037 9.86846 10.7483 9.45175 10.8807 9.05931C11.0131 8.66687 11.23 8.30827 11.5161 8.00882C11.8022 7.70936 12.1505 7.47635 12.5365 7.32624C12.9225 7.17612 13.3368 7.11255 13.75 7.14003C14.3498 7.14824 14.9482 7.20173 15.54 7.30003V9.30003H14.54C14.3676 9.27828 14.1924 9.29556 14.0276 9.35059C13.8627 9.40562 13.7123 9.49699 13.5875 9.61795C13.4627 9.73891 13.3667 9.88637 13.3066 10.0494C13.2464 10.2125 13.2237 10.387 13.24 10.56V12.07H15.46L15.1 14.4H13.25V20C15.1399 19.7011 16.8601 18.7347 18.0985 17.2761C19.3369 15.8175 20.0115 13.9634 20 12.05Z" fill="currentColor"/>
                        </svg>
                        <span>Share</span>
                    </a>
                    <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text=Check%20out%20this%20product" 
                       class="social-button twitter" 
                       title="Share on Twitter" 
                       target="_blank" rel="noopener noreferrer">
                        <svg class="social-icon" viewBox="0 0 24 24" width="20" height="20">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" fill="currentColor"/>
                        </svg>
                        <span>Tweet</span>
                    </a>
                    {% if product.images.all.0.image %}
                    <a href="https://pinterest.com/pin/create/button/?url={{ request.build_absolute_uri }}&media={{ product.images.all.0.image.url }}&description={{ product.name }}" 
                       class="social-button pinterest" 
                       title="Share on Pinterest" 
                       target="_blank" rel="noopener noreferrer">
                    {% else %}
                    <a href="https://pinterest.com/pin/create/button/?url={{ request.build_absolute_uri }}&description={{ product.name }}" 
                       class="social-button pinterest" 
                       title="Share on Pinterest" 
                       target="_blank" rel="noopener noreferrer">
                    {% endif %}
                        <svg class="social-icon" viewBox="0 0 24 24" width="20" height="20">
                            <path d="M12 0a12 12 0 0 0-3.82 23.3c-.1-.8-.18-2 .04-2.86l1.54-6.5s-.38-.76-.38-1.88c0-1.76 1-3.08 2.3-3.08 1.1 0 1.6.82 1.6 1.8 0 1.1-.7 2.76-1.1 4.3-.3 1.3.66 2.34 1.96 2.34 2.36 0 3.9-2.9 3.9-6.36 0-2.66-1.8-4.6-5-4.6-3.6 0-5.8 2.72-5.8 5.66 0 1 .3 1.74.8 2.3.08.1.1.18.06.28-.06.24-.2.8-.22.9-.04.16-.1.2-.24.12-1-.46-1.4-1.7-1.4-3.1 0-2.3 1.9-5.3 5.7-5.3 3.1 0 5.2 2.24 5.2 5.24 0 3.22-1.8 5.6-4.4 5.6-.88 0-1.7-.48-2-1.04l-.54 2.2c-.2.86-.74 1.94-1.1 2.6.8.26 1.68.4 2.6.4 6.6 0 12-5.4 12-12S18.6 0 12 0z" fill="currentColor"/>
                        </svg>
                        <span>Pin</span>
                    </a>
                </div>
            </div>
            
            <!-- Product details accordion -->
            <div class="product-accordion">
                <div class="accordion-item">
                    <button class="accordion-header" aria-expanded="false" aria-controls="details-content">
                        <span>Details & Care</span>
                        <svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="accordion-content" id="details-content">
                        <p>100% premium cotton. Machine wash cold with similar colors. Tumble dry low. Do not bleach. Iron low heat if needed.</p>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header" aria-expanded="false" aria-controls="shipping-content">
                        <span>Shipping & Returns</span>
                        <svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="accordion-content" id="shipping-content">
                        <p>Free shipping on all orders over $50. Returns accepted within 30 days of purchase. Items must be unworn with original tags.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Related products section -->
    <section class="related-products">
        <h2 class="section-title">منتجات قد تعجبك</h2>
        <div class="related-products-grid">
            {% if product.related_products.all %}
                {% for related_product in product.related_products.all %}
                    <div class="related-product-card">
                        <a href="{% url 'store:product_detail' related_product.id %}" class="product-link">
                            <div class="product-image">
                                {% if related_product.images.all %}
                                    {% if related_product.images.all.0.image %}
                                        <img src="{{ related_product.images.all.0.image.url }}" alt="{{ related_product.name }}" loading="lazy">
                                    {% else %}
                                        <img src="{{ related_product.images.all.0.image_url }}" alt="{{ related_product.name }}" loading="lazy">
                                    {% endif %}
                                {% else %}
                                    <img src="{% static 'store/images/no-image.svg' %}" alt="No image available" loading="lazy">
                                {% endif %}
                                {% if related_product.status == 'on_sale' and related_product.discount_price %}
                                <div class="product-badge sale">خصم</div>
                                {% elif related_product.status == 'new_arrival' %}
                                <div class="product-badge new">جديد</div>
                                {% endif %}
                            </div>
                            <h3 class="product-name">{{ related_product.name }}</h3>
                            <div class="product-meta">
                                <div class="product-price">
                                    {% if related_product.discount_price %}
                                    <span class="original-price">LE {{ related_product.price }}</span>
                                    <span class="discount-price">LE {{ related_product.discount_price }}</span>
                                    {% else %}
                                    <span>LE {{ related_product.price }}</span>
                                    {% endif %}
                                </div>
                                <div class="product-rating-mini">
                                    <span class="stars-mini">
                                        {% with ''|center:related_product.average_rating as range %}
                                        {% for _ in range %}
                                            <span class="star-mini filled">★</span>
                                        {% endfor %}
                                        {% endwith %}
                                        {% if related_product.average_rating < 5 %}
                                            {% with ''|center:5|slice:related_product.average_rating as empty_range %}
                                            {% for _ in empty_range %}
                                                <span class="star-mini">★</span>
                                            {% endfor %}
                                            {% endwith %}
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            {% else %}
                {% for related_product in similar_products %}
                    <div class="related-product-card">
                        <a href="{% url 'store:product_detail' related_product.id %}" class="product-link">
                            <div class="product-image">
                                {% if related_product.images.all %}
                                    {% if related_product.images.all.0.image %}
                                        <img src="{{ related_product.images.all.0.image.url }}" alt="{{ related_product.name }}" loading="lazy">
                                    {% else %}
                                        <img src="{{ related_product.images.all.0.image_url }}" alt="{{ related_product.name }}" loading="lazy">
                                    {% endif %}
                                {% else %}
                                    <img src="{% static 'store/images/no-image.svg' %}" alt="No image available" loading="lazy">
                                {% endif %}
                                {% if related_product.status == 'on_sale' and related_product.discount_price %}
                                <div class="product-badge sale">خصم</div>
                                {% elif related_product.status == 'new_arrival' %}
                                <div class="product-badge new">جديد</div>
                                {% endif %}
                            </div>
                            <h3 class="product-name">{{ related_product.name }}</h3>
                            <div class="product-meta">
                                <div class="product-price">
                                    {% if related_product.discount_price %}
                                    <span class="original-price">LE {{ related_product.price }}</span>
                                    <span class="discount-price">LE {{ related_product.discount_price }}</span>
                                    {% else %}
                                    <span>LE {{ related_product.price }}</span>
                                    {% endif %}
                                </div>
                                <div class="product-rating-mini">
                                    <span class="stars-mini">
                                        {% with ''|center:related_product.average_rating as range %}
                                        {% for _ in range %}
                                            <span class="star-mini filled">★</span>
                                        {% endfor %}
                                        {% endwith %}
                                        {% if related_product.average_rating < 5 %}
                                            {% with ''|center:5|slice:related_product.average_rating as empty_range %}
                                            {% for _ in empty_range %}
                                                <span class="star-mini">★</span>
                                            {% endfor %}
                                            {% endwith %}
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </section>
</div>

<style>
    :root {
        --primary-color: #000000;
        --primary-hover: rgb(113, 106, 106);
        --secondary-color: #000000;
        --text-color: #333;
        --text-light: #666;
        --text-lighter: #999;
        --border-color: #e0e0e0;
        --bg-light: #f9f9f9;
        --bg-lighter: #f5f5f5;
        --success-color: #4cc9f0;
        --warning-color: #f8961e;
        --error-color: #f94144;
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
        --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
        --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
        --transition: all 0.3s ease;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        color: var(--text-color);
        line-height: 1.6;
    }

    .product-detail-container {
        max-width: 1440px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Breadcrumb navigation */
    .product-navigation {
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
        font-size: 0.9rem;
        color: var(--text-light);
    }

    .nav-link {
        color: var(--text-light);
        text-decoration: none;
        transition: var(--transition);
    }

    .nav-link:hover {
        color: var(--primary-color);
        text-decoration: underline;
    }

    .nav-separator {
        color: var(--text-lighter);
    }

    .current-page {
        color: var(--text-color);
        font-weight: 500;
    }
    
    /* Main product grid layout */
    .product-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 40px;
        margin-bottom: 60px;
    }

    @media (min-width: 768px) {
        .product-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 1024px) {
        .product-grid {
            grid-template-columns: 1.25fr 1fr;
        }
    }
    
    /* Product images section */
    .product-images {
        position: relative;
    }
    
    .main-image-container {
        margin-bottom: 20px;
        position: relative;
        border-radius: var(--radius-lg);
        overflow: hidden;
        background-color: var(--bg-lighter);
        aspect-ratio: 1/1;
    }
    
    .main-image {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .main-image img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        transition: opacity 0.3s ease;
    }
    
    .sold-out-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background-color: var(--error-color);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        z-index: 2;
    }
    
    .thumbnail-gallery {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        padding-bottom: 10px;
        scrollbar-width: thin;
        scrollbar-color: var(--primary-color) var(--bg-light);
    }

    .thumbnail-gallery::-webkit-scrollbar {
        height: 4px;
    }

    .thumbnail-gallery::-webkit-scrollbar-track {
        background: var(--bg-light);
    }

    .thumbnail-gallery::-webkit-scrollbar-thumb {
        background-color: var(--primary-color);
        border-radius: 20px;
    }
    
    .thumbnail {
        min-width: 80px;
        height: 80px;
        border-radius: var(--radius-md);
        overflow: hidden;
        cursor: pointer;
        border: 2px solid transparent;
        transition: var(--transition);
        background-color: var(--bg-lighter);
        flex-shrink: 0;
    }
    
    .thumbnail:hover {
        border-color: var(--primary-color);
    }
    
    .thumbnail.active {
        border-color: var(--primary-color);
    }
    
    .thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .no-image-placeholder {
        background-color: var(--bg-lighter);
        border-radius: var(--radius-lg);
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        text-align: center;
    }

    .no-image-placeholder svg {
        margin-bottom: 10px;
        color: var(--text-lighter);
    }
    
    .no-image-placeholder p {
        color: var(--text-light);
        font-size: 0.9rem;
    }
    
    /* Product info section */
    .product-info {
        position: relative;
    }

    .product-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
    }

    .product-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-color);
        margin: 0;
        line-height: 1.3;
    }

    .product-price-tag {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        padding: 8px 16px;
        border-radius: var(--radius-md);
        color: white;
        display: flex;
        align-items: center;
        gap: 4px;
        font-weight: 700;
        box-shadow: var(--shadow-sm);
    }

    .currency {
        font-size: 0.9rem;
        opacity: 0.9;
    }

    .amount {
        font-size: 1.5rem;
    }

    /* Product rating */
    .product-rating {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
    }

    .stars {
        display: flex;
        gap: 2px;
    }

    .star {
        color: var(--border-color);
        font-size: 1.1rem;
    }

    .star.filled {
        color: var(--warning-color);
    }

    .review-count {
        font-size: 0.9rem;
        color: var(--text-light);
    }

    /* Product description */
    .product-description {
        margin-bottom: 25px;
    }

    .section-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .product-description p {
        color: var(--text-light);
        line-height: 1.7;
        font-size: 1rem;
    }
    
    /* Product attributes */
    .product-attributes {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 25px;
    }
    
    .attribute {
        background-color: var(--bg-light);
        padding: 12px 16px;
        border-radius: var(--radius-md);
        transition: var(--transition);
        border: 1px solid var(--border-color);
    }
    
    .attribute-label {
        display: block;
        font-weight: 500;
        color: var(--text-light);
        font-size: 0.85rem;
        margin-bottom: 4px;
    }
    
    .attribute-value {
        color: var(--text-color);
        font-weight: 500;
        font-size: 0.95rem;
    }
    
    /* Size selector */
    .product-size-selector {
        margin-bottom: 20px;
    }

    .selector-label {
        display: block;
        font-weight: 500;
        color: var(--text-color);
        margin-bottom: 10px;
        font-size: 0.95rem;
    }

    .size-options {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .size-options input[type="radio"] {
        position: absolute;
        opacity: 0;
    }

    .size-option {
        display: inline-block;
        padding: 8px 16px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.9rem;
        min-width: 40px;
        text-align: center;
    }

    .size-options input[type="radio"]:checked + .size-option {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    .size-options input[type="radio"]:focus-visible + .size-option {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }

    .size-option:hover {
        border-color: var(--primary-color);
    }

    /* Color selector */
    .product-color-selector {
        margin-bottom: 25px;
    }

    .color-options {
        display: flex;
        gap: 8px;
    }

    .color-options input[type="radio"] {
        position: absolute;
        opacity: 0;
    }

    .color-option {
        display: inline-block;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        border: 2px solid transparent;
    }

    .color-option::after {
        content: '';
        position: absolute;
        top: -4px;
        left: -4px;
        right: -4px;
        bottom: -4px;
        border: 1px solid var(--border-color);
        border-radius: 50%;
        transition: var(--transition);
    }

    .color-options input[type="radio"]:checked + .color-option::after {
        border-color: var(--primary-color);
    }

    .color-options input[type="radio"]:focus-visible + .color-option::after {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }

    /* Quantity selector */
    .quantity-selector {
        margin-bottom: 25px;
    }
    
    .quantity-selector {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
    }
    
    .quantity-label {
        margin-right: 15px;
        font-weight: 500;
        font-size: 0.95rem;
    }
    
    .quantity-controls {
        display: flex;
        align-items: center;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        overflow: hidden;
    }
    
    .quantity-btn {
        width: 40px;
        height: 40px;
        border: none;
        background-color: var(--bg-light);
        color: var(--text-color);
        font-size: 1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
    }
    
    .quantity-btn:hover {
        background-color: var(--bg-lighter);
    }
    
    .quantity-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    #product-quantity {
        width: 50px;
        height: 40px;
        border: none;
        border-left: 1px solid var(--border-color);
        border-right: 1px solid var(--border-color);
        text-align: center;
        font-size: 1rem;
        -moz-appearance: textfield;
    }
    
    #product-quantity::-webkit-outer-spin-button,
    #product-quantity::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    
    /* Action buttons */
    .action-buttons {
        display: flex;
        gap: 12px;
        margin-bottom: 30px;
    }
    
    .add-to-cart-btn {
        flex: 1;
        padding: 14px 20px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-weight: 600;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: var(--transition);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        box-shadow: var(--shadow-sm);
    }
    
    .add-to-cart-btn:hover {
        background-color: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }
    
    .add-to-cart-btn:active {
        transform: translateY(0);
    }
    
    .add-to-cart-btn.disabled {
        background-color: var(--text-lighter);
        cursor: not-allowed;
        box-shadow: none;
    }
    
    .add-to-cart-btn.disabled:hover {
        transform: none;
    }

    .btn-icon {
        display: flex;
    }

    .wishlist-btn {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: white;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition);
    }

    .wishlist-btn:hover {
        background-color: var(--bg-light);
        color: var(--secondary-color);
    }

    .notify-me-btn {
        flex: 1;
        padding: 14px 20px;
        background-color: white;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
        border-radius: var(--radius-md);
        font-weight: 600;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
    }

    .notify-me-btn:hover {
        background-color: var(--primary-color);
        color: white;
    }
    
    /* Social share */
    .social-share {
        margin: 30px 0;
    }
    
    .social-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .social-button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: var(--radius-sm);
        color: white;
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition);
        font-size: 0.85rem;
    }
    
    .social-button:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }
    
    .facebook {
        background-color: #1877f2;
    }
    
    .twitter {
        background-color: #1da1f2;
    }
    
    .pinterest {
        background-color: #e60023;
    }

    .social-icon {
        width: 16px;
        height: 16px;
    }
    
    /* Product accordion */
    .product-accordion {
        margin-top: 30px;
        border-top: 1px solid var(--border-color);
    }

    .accordion-item {
        border-bottom: 1px solid var(--border-color);
    }

    .accordion-header {
        width: 100%;
        padding: 16px 0;
        background: none;
        border: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        font-weight: 500;
        color: var(--text-color);
        text-align: left;
        transition: var(--transition);
    }

    .accordion-header:hover {
        color: var(--primary-color);
    }

    .accordion-icon {
        transition: transform 0.3s ease;
    }

    .accordion-header[aria-expanded="true"] .accordion-icon {
        transform: rotate(180deg);
    }

    .accordion-content {
        padding-bottom: 16px;
        font-size: 0.95rem;
        color: var(--text-light);
        line-height: 1.7;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
    }

    .accordion-header[aria-expanded="true"] + .accordion-content {
        max-height: 300px;
    }

    /* Related products */
    .related-products {
        margin-top: 60px;
    }

    .related-products-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-top: 20px;
    }

    @media (min-width: 640px) {
        .related-products-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (min-width: 1024px) {
        .related-products-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    .related-product-card {
        text-decoration: none;
        color: inherit;
        transition: var(--transition);
        background-color: white;
        border-radius: var(--radius-md);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        position: relative;
    }

    .related-product-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-md);
    }
    
    .related-product-card .product-link {
        text-decoration: none;
        color: var(--text-color);
        display: block;
    }

    .related-product-card .product-image {
        background-color: var(--bg-lighter);
        border-radius: var(--radius-md);
        aspect-ratio: 3/4;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 12px;
        overflow: hidden;
        position: relative;
    }

    .related-product-card .product-image img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        transition: transform 0.3s ease;
    }

    .related-product-card:hover .product-image img {
        transform: scale(1.05);
    }

    .related-product-card .product-name {
        font-size: 0.95rem;
        font-weight: 500;
        margin-bottom: 4px;
        padding: 0 10px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .related-product-card .product-meta {
        padding: 0 10px 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .related-product-card .product-price {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--primary-color);
    }
    
    .related-product-card .original-price {
        text-decoration: line-through;
        color: var(--text-lighter);
        font-size: 0.8rem;
        margin-right: 5px;
    }
    
    .related-product-card .discount-price {
        color: var(--error-color);
        font-weight: 600;
    }
    
    .product-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 4px 8px;
        border-radius: var(--radius-sm);
        font-size: 0.7rem;
        font-weight: 600;
        color: white;
        z-index: 1;
    }
    
    .product-badge.sale {
        background-color: var(--error-color);
    }
    
    .product-badge.new {
        background-color: var(--success-color);
    }
    
    .product-rating-mini {
        display: flex;
        align-items: center;
    }
    
    .stars-mini {
        display: inline-flex;
        font-size: 0.7rem;
    }
    
    .star-mini {
        color: var(--text-lighter);
    }
    
    .star-mini.filled {
        color: var(--warning-color);
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    /* Loading skeleton */
    .skeleton {
        animation: skeleton-loading 1s linear infinite alternate;
        background-color: var(--bg-light);
        border-radius: var(--radius-md);
    }

    @keyframes skeleton-loading {
        0% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    /* Accessibility improvements */
    .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }

    /* Focus styles for better accessibility */
    button:focus-visible,
    a:focus-visible,
    input:focus-visible,
    select:focus-visible {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }
</style>

<script>
    // Store product ID for use in JavaScript
    const productId = {{ product.id }};
    
    // Initialize the first thumbnail as active
    document.addEventListener('DOMContentLoaded', function() {
        const thumbnails = document.querySelectorAll('.thumbnail');
        if (thumbnails.length > 0) {
            thumbnails[0].classList.add('active');
        }

        // Initialize accordions
        const accordionHeaders = document.querySelectorAll('.accordion-header');
        accordionHeaders.forEach(header => {
            header.addEventListener('click', () => {
                const isExpanded = header.getAttribute('aria-expanded') === 'true';
                header.setAttribute('aria-expanded', !isExpanded);
            });
        });

        // Add to cart functionality
        const addToCartButton = document.getElementById('add-to-cart-button');
        if (addToCartButton) {
            addToCartButton.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Get selected options
                const sizeInput = document.querySelector('input[name="size"]:checked');
                const colorInput = document.querySelector('input[name="color"]:checked');
                const size = sizeInput ? sizeInput.nextElementSibling.textContent.trim() : '';
                const color = colorInput ? colorInput.dataset.colorName : '';
                const quantity = document.getElementById('product-quantity').value || 1;
                
                // Show loading state
                const originalText = this.querySelector('.btn-text').textContent;
                this.querySelector('.btn-text').textContent = 'Adding...';
                this.disabled = true;
                
                // Create a form and submit it to the server
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/product/${productId}/add-to-cart/`;
                
                // Add CSRF token
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken;
                form.appendChild(csrfInput);
                
                // Add size
                if (size) {
                    const sizeInput = document.createElement('input');
                    sizeInput.type = 'hidden';
                    sizeInput.name = 'size';
                    sizeInput.value = size;
                    form.appendChild(sizeInput);
                }
                
                // Add color
                if (color) {
                    const colorInput = document.createElement('input');
                    colorInput.type = 'hidden';
                    colorInput.name = 'color';
                    colorInput.value = color;
                    form.appendChild(colorInput);
                }
                
                // Add quantity
                const quantityInput = document.createElement('input');
                quantityInput.type = 'hidden';
                quantityInput.name = 'quantity';
                quantityInput.value = quantity;
                form.appendChild(quantityInput);
                
                // Append form to body and submit
                document.body.appendChild(form);
                form.submit();
            });
        }
    });
    
    // Function to change the main product image
    function changeMainImage(thumbnailElement, index) {
        // Update active thumbnail
        const thumbnails = document.querySelectorAll('.thumbnail');
        thumbnails.forEach(thumbnail => thumbnail.classList.remove('active'));
        thumbnailElement.classList.add('active');
        
        // Get the image source from the thumbnail
        const newImageSrc = thumbnailElement.querySelector('img').src;
        
        // Update the main image with fade effect
        const mainImageContainer = document.getElementById('main-product-image');
        const mainImage = mainImageContainer.querySelector('img');
        
        // Create a temporary image for preloading
        const tempImage = new Image();
        tempImage.src = newImageSrc;
        tempImage.onload = function() {
            // Fade out current image
            mainImage.style.opacity = '0';
            
            // After fade out completes, change src and fade in
            setTimeout(() => {
                mainImage.src = newImageSrc;
                mainImage.style.opacity = '1';
            }, 300);
        };
    }
    
    // Functions to handle quantity controls
    function incrementQuantity() {
        const quantityInput = document.getElementById('product-quantity');
        const maxQuantity = parseInt(quantityInput.getAttribute('max')) || 10;
        let currentValue = parseInt(quantityInput.value) || 1;
        
        if (currentValue < maxQuantity) {
            quantityInput.value = currentValue + 1;
        }
    }
    
    function decrementQuantity() {
        const quantityInput = document.getElementById('product-quantity');
        let currentValue = parseInt(quantityInput.value) || 1;
        
        if (currentValue > 1) {
            quantityInput.value = currentValue - 1;
        }
    }
</script>
{% endblock %}